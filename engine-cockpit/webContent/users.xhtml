<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:pm="http://primefaces.org/mobile">
<h:body>
	<ui:composition template="/template/template.xhtml">
		<ui:define name="title">Users</ui:define>
		
		<ui:define name="breadcrumb">
	        <li>Security</li>
	        <li>/</li>
	        <li><a href="users.xhtml">Users</a></li>
	    </ui:define>
		
		<ui:define name="content">
			<div class="ui-fluid users">
                <div class="ui-g">
                    <div class="ui-g-12">
                    	<h:form id="form">
	                        <p:growl id="msgs" showDetail="true" />
	                    	<p:tabView styleClass="card card-w-title tab-view-card" value="#{applicationBean.applications}" activeIndex="#{applicationBean.selectedApplicationIndex}" var="app">
					        	<p:ajax event="tabChange" listener="#{applicationBean.updateSelectedApplication}"/>
						        <p:tab title="#{app.name}">
							        <div class="ui-g">
				                    	<div class="ui-g-12 ui-md-10">
							            	<h1><i class="material-icons card-title-icon">person</i>Users</h1>
							            </div>
							            <div class="ui-g-12 ui-md-2" style="margin: auto;">
							            	<p:commandButton id="newUserBtn_#{app.id}" value="New" icon="ui-icon-add" type="button" onclick="PF('newUserModal').show();"/>
							            </div>
						            </div>
			                        <div class="ui-g">
				                        <div class="ui-g-12 ui-lg-12">
					                        <h:form id="tableForm">
						                        <p:dataTable var="user" value="#{userBean.getUsersForAppId(app.id)}" widgetVar="usersTable" selectionMode="single" 
						                        		selection="#{userBean.selectedUser}" rowKey="#{user.name}" filteredValue="#{userBean.filteredUsers}" lazy="false">
						                            <f:facet name="header">
											            <p:outputPanel>
											            	<p:outputLabel styleClass="table-search-icon"><i class="material-icons">search</i></p:outputLabel>
											                <p:inputText styleClass="table-search-input-withicon" id="globalFilter" onkeyup="PF('usersTable_#{app.id}').filter()" placeholder="Search"/>
											            </p:outputPanel>
											        </f:facet>
						                            <p:ajax event="rowSelect" onsuccess="window.location='userdetail.xhtml'"/>
						                            <p:column headerText="Name" sortBy="#{user.name}" filterBy="#{user.name}">
						                                <h:outputText value="#{user.name}">
						                                	<i class="material-icons table-icon">person</i>
						                                </h:outputText>
						                            </p:column>
						                            <p:column headerText="Full Name" sortBy="#{user.fullName}" filterBy="#{user.fullName}">
						                                <h:outputText value="#{user.fullName}" />
						                            </p:column>
						                            <p:column headerText="Email" sortBy="#{user.email}" filterBy="#{user.email}">
						                                <h:outputText value="#{user.email}" />
						                            </p:column>
						                            <p:column headerText="Logged in">
						                            	<h:outputText><i class="material-icons">#{user.loggedIn ? 'done' : 'clear'}</i></h:outputText>
						                            </p:column>
					                        	</p:dataTable>
					                        </h:form>
				                        </div>
			                        </div>
						        </p:tab>
						    </p:tabView>
                        </h:form>
                        <p:dialog style="min-width: 300px;" header="Add new user" widgetVar="newUserModal" modal="true" responsive="true">
                        	<p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group modal-input-form">
		                        <h:panelGroup styleClass="md-inputfield">
		                            <p:inputText />
		                            <label>Name</label>
		                        </h:panelGroup>
		                        <h:panelGroup styleClass="md-inputfield">
		                            <p:inputText />
		                            <label>Full Name</label>
		                        </h:panelGroup>
		                        <h:panelGroup styleClass="md-inputfield">
		                            <p:inputText />
		                            <label>E-Mail Address</label>
		                        </h:panelGroup>
		                        <h:panelGroup styleClass="md-inputfield">
		                            <p:password feedback="true" inline="true" />
		                            <label>Password</label>
		                        </h:panelGroup>
		                        <h:panelGroup styleClass="md-inputfield">
		                            <p:password feedback="true" inline="true" />
		                            <label>Confirm Password</label>
		                        </h:panelGroup>
	                    	</p:panelGrid>
	                    	<p:commandButton id="saveNewUser" onclick="PF('newUserModal').hide();" value="Save" type="button" icon="ui-icon-save" styleClass="primary-btn modal-input-button" />
		                	<p:commandButton id="cancelNewUser" onclick="PF('newUserModal').hide();" value="Cancel" type="button" icon="ui-icon-clear" styleClass="secondary-btn modal-input-button"/>
                        </p:dialog>
                	</div>
                </div>
            </div>
		</ui:define>
	</ui:composition>
</h:body>
</html>