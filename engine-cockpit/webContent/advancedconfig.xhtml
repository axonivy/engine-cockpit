<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:pm="http://primefaces.org/mobile"
  xmlns:cc="http://java.sun.com/jsf/composite/composite">
<h:body>
  <ui:composition template="/template/template.xhtml">
    <ui:define name="title">Advanced Configuration</ui:define>

    <ui:define name="breadcrumb">
      <li><a href="advancedconfig.xhtml">Advanced Configuration</a></li>
    </ui:define>
    
    <ui:define name="breadcrumb-help">
      <a href="#" onclick="window.open('#{advisorBean.engineGuideBaseUrl}/configuration/index.html'); return false;">
        <i class="material-icons">help</i>
      </a>
    </ui:define>

    <ui:define name="content">
      <cc:SingleCard id="card">
        <div class="card card-w-title">
          <div class="ui-g">
            <div class="ui-g-12 ui-md-9">
              <h1>
                <i class="material-icons card-title-icon">settings</i>
                <span>Advanced Configuration</span>
              </h1>
            </div>
            <div class="ui-g-12 ui-md-1" style="margin: auto;">
              <h:form id="showDefaultBtnForm">
                <p:commandButton icon="ui-icon-visibility#{advancedConfigBean.showDefaults ? '' : '-off'}" 
                  actionListener="#{advancedConfigBean.switchDefaults}" id="showDefaultsBtn" style="float: right;"
                  update="card:form,@this" styleClass="#{advancedConfigBean.showDefaults ? 'amber' : 'primary'}-btn">
                  <p:tooltip for="showDefaultsBtn" value="Show defaults" position="left" />
                </p:commandButton>
              </h:form>
            </div>
            <div class="ui-g-12 ui-md-2" style="margin: auto;">
              <p:commandButton id="newConfigBtn" value="New" icon="ui-icon-add" actionListener="#{advancedConfigBean.setActiveConfig(null)}"
                update="card:newConfigurationModal" oncomplete="PF('newConfigurationModal').show();" />
            </div>
          </div>
          <div class="ui-g">
            <div class="ui-g-12 ui-lg-12">
              <h:form id="form">
                <p:growl id="msgs" />
                <p:dataTable var="config" value="#{advancedConfigBean.configs}" widgetVar="advancedConfigTable"
                  filteredValue="#{advancedConfigBean.filteredConfigs}" id="advancedConfigTable">
                  <f:facet name="header">
                    <p:outputPanel>
                      <p:outputLabel styleClass="table-search-icon">
                        <i class="material-icons">search</i>
                      </p:outputLabel>
                      <p:inputText styleClass="table-search-input-withicon" id="globalFilter"
                        onkeyup="PF('advancedConfigTable').filter()" placeholder="Search" value="#{advancedConfigBean.filter}" />
                    </p:outputPanel>
                  </f:facet>
                  <p:column headerText="Name" sortBy="#{config.key}" filterBy="#{config.key}" styleClass="#{config.default ? 'default-value' : ''}">
                    <h:outputText value="#{config.key}" title="#{config.key}" styleClass="config-name">
                      <i class="material-icons table-icon">#{config.password ? 'vpn_key' : 'settings'}</i>
                    </h:outputText>
                  </p:column>
                  <p:column headerText="Value" filterBy="#{config.value}" styleClass="#{config.default ? 'default-value' : ''}">
                    <h:outputText value="#{config.password ? '******' : config.value}" />
                  </p:column>
                  <p:column headerText="Location" sortBy="#{config.shortSource}" filterBy="#{config.shortSource}" style="width: 80px;">
                    <h:outputText value="#{config.shortSource}" title="#{config.source}" />
                  </p:column>
                  <p:column style="width: 70px;">
                    <p:commandButton title="More" id="tasksButton" disabled="#{config.default}"
                      type="button" icon="ui-icon-menu" styleClass="secondary-btn" style="margin-right: 0; float: right;" />
                    <p:menu overlay="true" trigger="tasksButton" my="right top" at="right bottom" id="activityMenu">
                      <p:menuitem value="View File" icon="ui-icon-find-in-page" oncomplete="PF('showConfigurationFileModal').show()"
                        actionListener="#{advancedConfigBean.setActiveConfig(config.key)}" update="card:showConfigurationFileModal" 
                        id="showFileBtn">
                      </p:menuitem>
                      <p:menuitem value="Reset" icon="ui-icon-close" disabled="#{config.shortSource eq 'app.yaml'}"
                        actionListener="#{advancedConfigBean.setActiveConfig(config.key)}" id="resetConfigBtn"
                        update="card:form:resetConfigConfirmDialog" oncomplete="PF('resetConfigConfirmDialog').show()" />
                    </p:menu>
                  	<p:commandButton id="editConfigBtn" icon="ui-icon-edit" title="Edit" 
                      styleClass="card-button table-control-btn amber-btn"
                      actionListener="#{advancedConfigBean.setActiveConfig(config.key)}"
                      update="card:editConfigurationModal" oncomplete="PF('editConfigurationModal').show()"/>
                  </p:column>
                </p:dataTable>
                <p:confirmDialog id="resetConfigConfirmDialog" header="Reset Config"
                  message="Are you sure about reseting the configuration '#{advancedConfigBean.activeConfig.key}=#{advancedConfigBean.activeConfig.password ? '******' : advancedConfigBean.activeConfig.value}'?" 
                  severity="alert" widgetVar="resetConfigConfirmDialog">
                  <p:commandButton id="resetConfigConfirmYesBtn" value="Yes" ajax="false" immediate="true" actionListener="#{advancedConfigBean.resetConfig}"
                    icon="ui-icon-check" style="width: inherit;" />
                  <p:commandButton value="Cancel" onclick="PF('deleteConfigConfirmDialog').hide();" type="button" icon="ui-icon-close"
                    style="width: inherit;" />
                </p:confirmDialog>
              </h:form>
               <ui:include src="dialogs/editconfiguration.xhtml" />
               <ui:include src="dialogs/newconfiguration.xhtml" />
               <ui:include src="dialogs/showconfigurationfile.xhtml" />
            </div>
          </div>
        </div>
      </cc:SingleCard>
    </ui:define>
  </ui:composition>
</h:body>
</html>