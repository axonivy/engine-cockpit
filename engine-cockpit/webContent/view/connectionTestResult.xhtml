<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:p="http://primefaces.org/ui"
  xmlns:jc="http://xmlns.jcp.org/jsf/composite/demo-jsfcomponents">
<h:head>
  <f:attribute name="primefaces.THEME" value="freya-ivy-#{ivyFreyaTheme.mode}" />
  <f:facet name="first">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
  </f:facet>
  <title>Connection Test - Url: #{restClientDetailBean.restClient.connectionUrl}</title>
  <link rel="shortcut icon" href="#{resource['resources/images/favicon.png']}" />
</h:head>

<f:metadata>
  <f:viewParam name="app" value="#{restClientDetailBean.app}" />
  <f:viewParam name="name" value="#{restClientDetailBean.name}" />
  <f:viewAction action="#{restClientDetailBean.onload()}" />
</f:metadata>

<h:body style="background-color:white">
  <h:form id="connTestForm" styleClass="custom-dialog-form">
    <h:panelGroup style="height:150px" id="missingCertView"
      rendered="#{tlsTesterBean.hasMissingCerts(restClientDetailBean.restClient.connectionUrl)}">
      <jc:TlsTesterMissingCertView id="missing" bean="#{tlsTesterBean}" cert="#{tlsTesterBean.missingCert}"/>
    </h:panelGroup>
    <h:panelGrid id="resultLog" columns="1" style="height:500px"
      styleClass="ui-fluid">
      <h:panelGroup id="resultConnect">
        <h:outputText value="#{restClientDetailBean.result.testResult}"
          style="font-weight: bold; color: #{restClientDetailBean.result.testResultColor}" />
        <pre style="max-height: 600px; overflow: auto; margin: 0;">#{restClientDetailBean.result.message}</pre>
      </h:panelGroup>
      <h:panelGroup id="resultTLS" styleClass="ui-fluid" rendered="#{tlsTesterBean.tlsTestRendered}">
        <jc:TlsTester url="#{restClientDetailBean.restClient.connectionUrl}" />
      </h:panelGroup>
    </h:panelGrid>
    <h:panelGroup class="custom-dialog-footer">
      <p:commandButton id="testTlsConectionBtn" title="TLS Connection Test"
        rendered="#{tlsTesterBean.isHttps(restClientDetailBean.restClient.connectionUrl)}"
        icon="si si-arrow-right" value="TLS Test" update="@form"
        styleClass="modal-input-button"
        action="#{restClientDetailBean.reset}"
        actionListener="#{tlsTesterBean.testConnection(restClientDetailBean.restClient.connectionUrl)}" />
      <p:commandButton id="testConnectionBtn" title="Test Connection"
        update="@form" value="Test Connection" icon="si si-arrow-right"
        styleClass="modal-input-button" onclick="buttonAddSpinner(this);"
        actionListener="#{restClientDetailBean.testRestConnection()}"
        immediate="true" process="@this" async="true"
        action="#{tlsTesterBean.setTlsTestRendered(false)}" />
      <p:commandButton id="closeConTesterDialog"
        actionListener="#{dynamicDialog.close('connectionTestResult')}"
        action="#{restClientDetailBean.reset()}" value="Close" update="connTestForm"
        styleClass="modal-input-button ui-button-secondary ui-button-flat" />
    </h:panelGroup>
  </h:form>

  <h:outputStylesheet name="css/layout-ivy-#{ivyFreyaTheme.mode}.css" library="freya-layout" />
  <h:outputStylesheet name="primeflex-3.min.css" library="primeflex" />
  <h:outputStylesheet name="resources/css/engine-cockpit.css" />
</h:body>
</html>
