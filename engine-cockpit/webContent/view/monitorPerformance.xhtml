<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:cc="http://java.sun.com/jsf/composite/composite">
<h:body>
  <ui:composition template="../includes/template/template.xhtml">

    <ui:define name="breadcrumb">
      <li>Monitor</li>
      <li>/</li>
      <li>Performance</li>
      <li>/</li>
      <li><a href="monitorPerformance.xhtml">Statistic</a></li>
    </ui:define>

    <ui:define name="breadcrumb-right">
       <a href="systemconfig.xhtml?filter=ProcessEngine.FiringStatistic" title="Performance Statistic Configuration" id="performance:form:config">
        <i class="si si-lg si-cog"></i>
      </a>
      <a
        href="#{advisorBean.cockpitEngineGuideUrl}monitor.html#performance"
        target="_blank" rel="noopener noreferrer"> <i
        class="si si-lg si-question-circle"></i>
      </a>
    </ui:define>

    <ui:define name="content">
      <cc:SingleCard id="performance">
        <div class="card card-w-title">
          <h:form id="form">
            <div class="ui-g">
              <div class="ui-g-12 ui-md-10">
                <h1>
                  <i class="si si-optimization-timer"></i> Performance Statistic
                </h1>
              </div>
            </div>
            <p:staticMessage id="loggingWarning" rendered="#{performanceBean.loggingActive}" severity="warn" summary="Logging Active!"
                detail="The process element performance statistic logger is active. The statistic is automatically cleaned by the logger every #{performanceBean.loggingInterval}!"/>
            <div class="ui-g">
              <div class="ui-g-11">
                <p:commandButton id="start" onclick="PF('startRecordingDialog').show();" title="Start recording"
                    icon="si si-controls-play" styleClass="green-btn" disabled="#{performanceBean.notStartable}" style="margin-right: 10px; margin-bottom: 10px"/>
                <p:commandButton id="stop" actionListener="#{performanceBean.stop}" update="performance:form" title="Stop recording"
                    icon="si si-controls-stop" styleClass="red-btn" disabled="#{performanceBean.notStoppable}" style="margin-right: 10px;"/>
                <p:commandButton id="clear" actionListener="#{performanceBean.clear}" update="performance:form" title="Clear statistic"
                    icon="si si-bin-1" styleClass="red-btn" disabled="#{performanceBean.notCleanable}" style="margin-right: 10px;"/>
                <p:commandButton id="refresh" actionListener="#{performanceBean.refresh}" update="performance:form" title="Refresh statistic"
                    icon="si si-button-refresh-arrows" disabled="#{performanceBean.notRefreshable}" style="margin-right: 10px;"/>
                <p:commandButton id="export" title="Export statistic" ajax="false"
                    icon="si si-office-file-xls-1" disabled="#{performanceBean.notCleanable}">
                  <p:dataExporter type="xlsxstream" target="performanceTable" fileName="PerformanceStatistic"/>
                </p:commandButton>
                
              </div>
             </div>
                
            <p:dataTable var="processElement" value="#{performanceBean.processElements}"
              widgetVar="performanceTable" filteredValue="#{performanceBean.filteredProcessElements}"
              id="performanceTable" resizableColumns="true">
              
              <f:facet name="header">
                <p:outputPanel>
                  <p:outputLabel styleClass="table-search-icon">
                    <i class="si si-search"></i>
                  </p:outputLabel>
                  <p:inputText styleClass="table-search-input-with2icon"
                    id="globalFilter" onkeyup="PF('performanceTable').filter()"
                    placeholder="Search" value="#{performanceBean.filter}" />
                  <p:commandButton id="toggler" type="button" icon="si si-layers-grid-settings" styleClass="secondary-btn"/>	                    
                  <p:columnToggler datasource="performanceTable" trigger="toggler"/>
                </p:outputPanel>
              </f:facet>
              
              <p:column sortBy="#{processElement.order}" sortOrder="ASCENDING" style="width: 50px">
                <f:facet name="header">
                  <h:outputText value="Order" title="Order of first execution"/>
                </f:facet>
                <h:outputText value="#{processElement.order}"/>
              </p:column>

              <p:column sortBy="#{processElement.application}" filterBy="#{processElement.application}" visible="false">
                <f:facet name="header">
                  <h:outputText value="Application" title="Application"/>
                </f:facet>
                <h:outputText value="#{processElement.application}" title="#{processElement.application}"/>
              </p:column>

              <p:column sortBy="#{processElement.processModel}" filterBy="#{processElement.processModel}" visible="false">
                <f:facet name="header">
                  <h:outputText value="PM" title="Process Model"/>
                </f:facet>
                <h:outputText value="#{processElement.processModel}" title="#{processElement.processModel}"/>
              </p:column>

              <p:column sortBy="#{processElement.version}" filterBy="#{processElement.version}" visible="false">
                <f:facet name="header">
                  <h:outputText value="Version" title="Process Model Version"/>
                </f:facet>
                <h:outputText value="#{processElement.version}" title="#{processElement.version}"/>
              </p:column>

              <p:column sortBy="#{processElement.process}" filterBy="#{processElement.process}" style="width: 250px">
                <f:facet name="header">
                  <h:outputText value="Process" title="Process Name"/>
                </f:facet>
                <h:outputText value="#{processElement.process}" title="#{processElement.process}"/>
              </p:column>

              <p:column sortBy="#{processElement.name}" filterBy="#{processElement.name}" style="width: 250px">
                <f:facet name="header">
                  <h:outputText value="Name" title="Process Element Name"/>
                </f:facet>
                <h:outputText value="#{processElement.name}" title="#{processElement.name}"/>
              </p:column>

              <p:column sortBy="#{processElement.id}" filterBy="#{processElement.id}" style="width: 140px">
                <f:facet name="header">
                  <h:outputText value="Id" title="Process Element Id (PID)"/>
                </f:facet>
                <h:outputText value="#{processElement.id}" title="#{processElement.id}"/>
              </p:column>

              <p:column sortBy="#{processElement.type}" filterBy="#{processElement.type}" style="width: 90px">
                <f:facet name="header">
                  <h:outputText value="Type" title="Process Element Type"/>
                </f:facet>
                <h:outputText value="#{processElement.type}" title="#{processElement.type}"/>
              </p:column>

              <p:column sortBy="#{processElement.totalExecutionTime}" visible="false" style="width: 65px" exportFunction="#{performanceBean.export}">
                <f:facet name="header">
                  <h:outputText value="Total" title="Total execution time [ms] (internal + external)"/>
                </f:facet>
                <div style="background: #{processElement.totalExecutionTimeBackground};">
                  <h:outputText value="#{processElement.totalExecutionTime}" title="#{processElement.totalExecutionTime}"/>
                </div>
              </p:column>

              <p:column sortBy="#{processElement.internalExecutions}" style="width: 100px" exportFunction="#{performanceBean.export}">
                <f:facet name="header">
                  <h:outputText value="Int Executions" title="Number of engine internal executions"/>
                </f:facet>
                <div style="background: #{processElement.internalExecutionsBackground};">
                  <h:outputText value="#{processElement.internalExecutions}" title="#{processElement.internalExecutions}"/>
                </div>                  
              </p:column>
              
              <p:column sortBy="#{processElement.totalInternalExecutionTime}" style="width: 65px" exportFunction="#{performanceBean.export}">
                <f:facet name="header">
                  <h:outputText value="Int Total" title="Total of engine internal execution time [ms]"/>
                </f:facet>
                <div style="background: #{processElement.totalInternalExecutionTimeBackground};">
                  <h:outputText value="#{processElement.totalInternalExecutionTime}" title="#{processElement.totalInternalExecutionTime}"/>
                </div>
              </p:column>
              
              <p:column sortBy="#{processElement.minInternalExecutionTime}" visible="false" style="width: 65px" exportFunction="#{performanceBean.export}">
                <f:facet name="header">
                  <h:outputText value="Int Min" title="Minimum of engine internal execution time [ms]"/>
                </f:facet>
                <div style="background: #{processElement.minInternalExecutionTimeBackground};">
                  <h:outputText value="#{processElement.minInternalExecutionTime}" title="#{processElement.minInternalExecutionTime}"/>
                </div>
              </p:column>
              
              <p:column sortBy="#{processElement.avgInternalExecutionTime}" style="width: 65px" exportFunction="#{performanceBean.export}">
                <f:facet name="header">
                  <h:outputText value="Int Avg" title="Average of engine internal execution time [ms]"/>
                </f:facet>
                <div style="background: #{processElement.avgInternalExecutionTimeBackground};">
                  <h:outputText value="#{processElement.avgInternalExecutionTime}" title="#{processElement.avgInternalExecutionTime}"/>
                </div>
              </p:column>

              <p:column sortBy="#{processElement.maxInternalExecutionTime}" style="width: 65px" exportFunction="#{performanceBean.export}">
                <f:facet name="header">
                  <h:outputText value="Int Max" title="Maximum of engine internal execution time [ms]"/>
                </f:facet>
                <div style="background: #{processElement.totalInternalExecutionTimeBackground};">
                  <h:outputText value="#{processElement.maxInternalExecutionTime}" title="#{processElement.maxInternalExecutionTime}"/>
                </div>
              </p:column>
              <p:column sortBy="#{processElement.externalExecutions}" visible="false" style="width: 100px" exportFunction="#{performanceBean.export}">
                <f:facet name="header">
                  <h:outputText value="Ext Executions" title="Number of external executions"/>
                </f:facet>
                <div style="background: #{processElement.externalExecutionsBackground};">
                  <h:outputText value="#{processElement.externalExecutions}" title="#{processElement.externalExecutions}"/>
                </div>
              </p:column>
              <p:column sortBy="#{processElement.totalExternalExecutionTime}" style="width: 65px" exportFunction="#{performanceBean.export}">
                <f:facet name="header">
                  <h:outputText value="Ext Total" title="Total of external execution time [ms]"/>
                </f:facet>
                <div style="background: #{processElement.totalExternalExecutionTimeBackground};"> 
                  <h:outputText value="#{processElement.totalExternalExecutionTime}" title="#{processElement.totalExternalExecutionTime}"/>
                </div>
              </p:column>
              <p:column sortBy="#{processElement.minExternalExecutionTime}" visible="false" style="width: 65px" exportFunction="#{performanceBean.export}">
                <f:facet name="header">
                  <h:outputText value="Ext Min" title="Minimum of external execution time [ms]"/>
                </f:facet>
                <div style="background: #{processElement.minExternalExecutionTimeBackground};"> 
                  <h:outputText value="#{processElement.minExternalExecutionTime}" title="#{processElement.minExternalExecutionTime}"/>
                </div>
              </p:column>
              <p:column sortBy="#{processElement.avgExternalExecutionTime}" style="width: 65px" exportFunction="#{performanceBean.export}">
                <f:facet name="header">
                  <h:outputText value="Ext Avg" title="Average of external execution time [ms]"/>
                </f:facet>
                <div style="background: #{processElement.avgExternalExecutionTimeBackground};"> 
                  <h:outputText value="#{processElement.avgExternalExecutionTime}" title="#{processElement.avgExternalExecutionTime}"/>
                </div>
              </p:column>
              <p:column sortBy="#{processElement.maxExternalExecutionTime}" style="width: 65px" exportFunction="#{performanceBean.export}">
                <f:facet name="header">
                  <h:outputText value="Ext Max" title="Maximum of external execution time [ms]"/>
                </f:facet>
                <div style="background: #{processElement.maxExternalExecutionTimeBackground};"> 
                  <h:outputText value="#{processElement.maxExternalExecutionTime}" title="#{processElement.maxExternalExecutionTime}"/>
                </div>
              </p:column>
            </p:dataTable>
          </h:form>
        </div>
      </cc:SingleCard>
      <p:confirmDialog style="min-width: 300px;" header="Start Recording" id="startRecordingDialog"
            widgetVar="startRecordingDialog" responsive="true" closeOnEscape="true" styleClass="dashboard-card">
        <h:form id="startPerformance">
          <p:staticMessage severity="warn" detail="Start the recording of the performance statistics can have a negative impact on the performance of the engine." />
          <p:commandLink id="cancel" type="button" onclick="PF('startRecordingDialog').hide();" value="Cancel" styleClass="modal-input-button"/>
          <p:commandButton id="start" onclick="PF('startRecordingDialog').hide();" value="Start" icon="si si-controls-play"                  
            styleClass="modal-input-button" actionListener="#{performanceBean.start}" update="performance:form"/>
        </h:form>
      </p:confirmDialog>
    </ui:define>
  </ui:composition>
</h:body>
</html>
