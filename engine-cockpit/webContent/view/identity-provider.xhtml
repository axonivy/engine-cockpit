<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:cc="http://java.sun.com/jsf/composite/composite">

<h:body>
  <f:metadata>
    <f:viewParam name="securitySystemName" value="#{identityProviderBean.securitySystemName}" />
    <f:viewAction action="#{identityProviderBean.onload}" />
  </f:metadata>

  <ui:composition template="../includes/template/template.xhtml">

    <ui:define name="breadcrumb">
      <li><span>Security</span></li>
      <li>/</li>
      <li><a href="securitysystem.xhtml">Security Systems</a></li>
      <li>/</li>      
      <li><a href="#{identityProviderBean.securitySystemLink}">#{identityProviderBean.securitySystemName}</a></li>
      <li>/</li>
      <li>#{identityProviderBean.identityProviderName}</li>
    </ui:define>

    <ui:define name="topbar-items">
      <cc:TopBarItem href="#{advisorBean.cockpitEngineGuideUrl}security.html#security-system-detail" />
    </ui:define>

    <ui:define name="content">
      <div class="layout-dashboard">
        <div class="p-grid">
          <h:panelGroup>
            <div class="p-col-12 p-md-12 p-xl-12">
                <h:form id="securityIdentityProviderForm">
                  <p:growl id="securityIdentityProviderSaveSuccess" for="securityIdentityProviderSaveSuccess">
                    <p:autoUpdate />
                  </p:growl>

                  <p:repeat var="group" id="group" value="#{identityProviderBean.propertyGroups}">
                    <div class="card">
                      <div class="card-header">
                        <div class="card-title p-d-flex p-ai-center">
                          <i class="p-pr-3 si si-information-circle"></i>
                          <h6 class="p-m-0">#{group.name}</h6>
                          
                          <p:commandButton title="Save" icon="si si-floppy-disk" id="save" styleClass="p-col-fixed p-ml-auto p-ml-1 ui-button-success rounded-button" rendered="#{!group.keyValue}" actionListener="#{identityProviderBean.save(group)}"/>
                          
                         <p:commandButton id="newPropertyKeyValue" 
                         actionListener="#{identityProviderListDialogBean.setProperty(group.getKeyValueProperty())}"
                         rendered="#{group.keyValue}" 
                         oncomplete="PF('propertyKeyValueModal').show();" process="@this" update=":propertyKeyValueModal" title="Add" icon="si si-add" styleClass="p-col-fixed p-ml-auto rounded-button" />
                          
                        </div>
                      </div>
                    <p:repeat var="property" id="property" value="#{group.properties}">
                      <ui:fragment>

                        <!-- string -->
                        <p:panelGrid columns="2" layout="flex" columnClasses="p-col-12, p-col-12 p-md-10 p-lg-10" styleClass="grey-label-panel ui-fluid" rendered="#{property.string}">
                          <p:outputLabel value="#{property.label}" />
                             <h:panelGroup styleClass="md-inputfield">
                             <h:panelGroup styleClass="ui-inputgroup">
                                 <p:inputText id="propertyString" value="#{property.value}" placeholder="#{property.defaultValue}"  />
                                <p:commandButton id="browseDefaultContext" icon="si si-network-browser" title="Browse" 
                                  actionListener="#{identityProviderBean.browseProperty(property)}" 
                                  oncomplete="PF('directoryBrowserDialog').show();" 
                                  update="directoryBrowser:directoryBrowserDialog"
                                  rendered="#{property.isDirectoryBrowser()}" />
                             </h:panelGroup>
                                <small class="block">#{property.descriptionFirstline}</small>
                                <h:panelGroup id="usedByHelp" styleClass="label-help-icon" rendered="#{property.hasSecondLine()}">
                                  <i class="si si-question-circle"></i>
                                  <p:tooltip for="@parent" value="#{property.description}" position="top"/>
                                </h:panelGroup>
                          </h:panelGroup>
                       </p:panelGrid>

                       <!-- password -->
                       <p:panelGrid columns="2" layout="flex" columnClasses="p-col-12, p-col-12 p-md-10 p-lg-10" styleClass="grey-label-panel ui-fluid" rendered="#{property.password}">
                          <p:outputLabel value="#{property.label}" />
                          <h:panelGroup  styleClass="md-inputfield">
                            <p:password id="propertyPassword" value="#{property.value}" placeholder="#{property.passwordPlaceholder}"></p:password>
                            <small class="block">#{property.descriptionFirstline}</small>
                                <h:panelGroup id="usedByHelp" styleClass="label-help-icon" rendered="#{property.hasSecondLine()}">
                                  <i class="si si-question-circle"></i>
                                  <p:tooltip for="@parent" value="#{property.description}" position="top"/>
                                </h:panelGroup>
                          </h:panelGroup>
                       </p:panelGrid>

                       <!-- boolean -->
                       <p:panelGrid columns="2" layout="flex" columnClasses="p-col-12, p-col-12 p-md-10 p-lg-10" styleClass="grey-label-panel ui-fluid" rendered="#{property.boolean}">
                          <p:outputLabel value="#{property.label}" />
                          <h:panelGroup  styleClass="md-inputfield">
                            <p:selectBooleanCheckbox id="propertyBoolean" value="#{property.value}" />
                            <small class="block">#{property.descriptionFirstline}</small>
                                <h:panelGroup id="usedByHelp" styleClass="label-help-icon" rendered="#{property.hasSecondLine()}">
                                  <i class="si si-question-circle"></i>
                                  <p:tooltip for="@parent" value="#{property.description}" position="top"/>
                                </h:panelGroup>
                          </h:panelGroup>
                       </p:panelGrid>
                       
                        <!-- number -->
                       <p:panelGrid columns="2" layout="flex" columnClasses="p-col-12, p-col-12 p-md-10 p-lg-10" styleClass="grey-label-panel ui-fluid" rendered="#{property.number}">
                          <p:outputLabel value="#{property.label}" />
                          <h:panelGroup  styleClass="md-inputfield">
                            <p:inputNumber id="propertyNumber" value="#{property.value}" decimalPlaces="0" placeholder="#{property.defaultValue}" />
                            <small class="block">#{property.descriptionFirstline}</small>
                                <h:panelGroup id="usedByHelp" styleClass="label-help-icon" rendered="#{property.hasSecondLine()}">
                                  <i class="si si-question-circle"></i>
                                  <p:tooltip for="@parent" value="#{property.description}" position="top"/>
                                </h:panelGroup>
                          </h:panelGroup>
                       </p:panelGrid>

                        <!-- dropdown -->
                       <p:panelGrid columns="2" layout="flex" columnClasses="p-col-12, p-col-12 p-md-10 p-lg-10" styleClass="grey-label-panel ui-fluid" rendered="#{property.dropdown}">
                          <p:outputLabel value="#{property.label}" />
                          <h:panelGroup  styleClass="md-inputfield">
                            <p:selectOneMenu id="propertyDropdown" value="#{property.value}" >
                              <f:selectItems value="#{property.enumerationValues}" var="value" itemLabel="#{value}" itemValue="#{value}"/>
                              </p:selectOneMenu>
                           <small class="block">#{property.descriptionFirstline}</small>
                                <h:panelGroup id="usedByHelp" styleClass="label-help-icon" rendered="#{property.hasSecondLine()}">
                                  <i class="si si-question-circle"></i>
                                  <p:tooltip for="@parent" value="#{property.description}" position="top"/>
                                </h:panelGroup>
                          </h:panelGroup>
                       </p:panelGrid>

                       <!-- keyvalue -->
                       <p:panelGrid columns="1" layout="flex" styleClass="grey-label-panel ui-fluid" rendered="#{property.keyValue}">
                             <p:dataTable paginator="true" rows="10" paginatorPosition="bottom" paginatorAlwaysVisible="false"
                                          value="#{property.getKeyValueProperty().getKeyValue()}" var="keyValue" id="keyValueTable">
                               <p:column headerText="#{property.getKeyValueProperty().getKeyValueKeyName()}"> 
                                 <h:outputText value="#{keyValue.key}" styleClass="ldap-attribute" />
                               </p:column>
                               <p:column headerText="#{property.getKeyValueProperty().getKeyValueValueName()}" styleClass="ldap-value">
                                 <h:outputText value="#{keyValue.value}" />
                               </p:column>
                               <p:column styleClass="table-btn-2">
                                 <p:commandButton id="editPropertyBtn" actionListener="#{identityProviderListDialogBean.setProperty(property.getKeyValueProperty(), keyValue.key, keyValue.value)}"
                                                  icon="si si-pencil" title="Edit"
                                                  styleClass="ui-button-secondary rounded-button" oncomplete="PF('propertyKeyValueModal').show();"
                                                  process="@this" update=":propertyKeyValueModal" />
                                 <p:commandButton id="deleteKeyValueBtn" type="button" icon="si si-bin-1" title="Delete"
                                                  styleClass="p-ml-1 ui-button-danger rounded-button">
                                   <p:ajax listener="#{property.getKeyValueProperty().removeKeyValue(keyValue.key)}" update="@form" />
                                </p:commandButton>
                               </p:column>
                              </p:dataTable> 
                              <h:panelGroup>
                            <small class="block">#{property.descriptionFirstline}</small>
                                <h:panelGroup id="usedByHelp" styleClass="label-help-icon" rendered="#{property.hasSecondLine()}">
                                  <i class="si si-question-circle"></i>
                                  <p:tooltip for="@parent" value="#{property.description}" position="top"/>
                                </h:panelGroup>
                              </h:panelGroup>
                       </p:panelGrid>
                       
                      </ui:fragment>
                    </p:repeat>
                   </div>
                  </p:repeat>
                </h:form>

                <p:dialog style="min-width: 300px;" header="Property" id="propertyKeyValueModal" widgetVar="propertyKeyValueModal"
                          modal="true" responsive="true" closeOnEscape="true">
                  <h:form id="identityProviderKeyValueForm" styleClass="custom-dialog-form">
                    <p:panelGrid columns="2" layout="flex" columnClasses="p-col-3, p-col-9" styleClass="grey-label-panel ui-fluid">
                      <p:outputLabel for="attributeNameInput" value="#{identityProviderListDialogBean.property.keyValueKeyName}" />
                      <h:panelGroup styleClass="md-inputfield">
                        <p:inputText id="attributeNameInput" requiredMessage="Value is required" value="#{identityProviderListDialogBean.newKey}"  disabled="#{not empty identityProviderListDialogBean.newKey}" required="true" />
                        <p:message for="attributeNameInput" id="attributeNameMessage" />
                      </h:panelGroup>


                      <p:outputLabel for="attributeValueInput" value="#{identityProviderListDialogBean.property.keyValueValueName}" />
                      
                      <h:panelGroup styleClass="md-inputfield">

                        <h:panelGroup styleClass="ui-inputgroup">
                          <p:inputText id="attributeValueInput" requiredMessage="Value is required" required="true" value="#{identityProviderListDialogBean.newValue}" />
                          <p:commandButton id="browseImportUserOfGroup" icon="si si-network-browser" title="Browse" 
                                  actionListener="#{identityProviderBean.browseBeanProperty(identityProviderListDialogBean)}" 
                                  oncomplete="PF('directoryBrowserDialog').show();"
                                  rendered="#{identityProviderListDialogBean.isDirectoryBrowser()}"
                                  update="directoryBrowser:directoryBrowserDialog" immediate="true" process="@this,attributeNameInput" />
                        </h:panelGroup>
                      <p:message for="attributeValueInput" id="attributeValueMessage" />

                      </h:panelGroup>
                      
                   </p:panelGrid>

                   <div class="custom-dialog-footer">
                     <p:commandButton id="cancelPropertyKeyValue" onclick="PF('propertyKeyValueModal').hide();" value="Cancel" type="button"
                                      styleClass="ui-button-secondary ui-button-flat modal-input-button" immediate="true" />
                     <p:commandButton id="savePropertyKeyAttribute" validateClient="true" ajax="false" update=":securityIdentityProviderForm"
                                      actionListener="#{identityProviderListDialogBean.saveProp}" value="Save" icon="si si-floppy-disk"
                                      styleClass="modal-input-button" />
                   </div>
                 </h:form>
                </p:dialog>
            </div>
            
            <cc:DirectoryBrowser id="directoryBrowser" directoryBrowser="#{identityProviderBean.directoryBrowser}"
                updateFields="securityIdentityProviderForm, identityProviderKeyValueForm" 
                returnListener="#{identityProviderBean.setSelectedItem()}" />
          </h:panelGroup>
        </div>
      </div>
    </ui:define>
  </ui:composition>
</h:body>
</html>
