<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:cc="http://java.sun.com/jsf/composite/composite">
<h:body>
  <ui:composition template="../includes/template/charts-template.xhtml">

    <ui:define name="breadcrumb">
      <li>Monitor</li>
      <li>/</li>
      <li>Engine</li>
      <li>/</li>
      <li><a href="mbeans.xhtml">MBeans</a></li>
    </ui:define>

    <ui:define name="breadcrumb-right">
      <a href="#{advisorBean.cockpitEngineGuideUrl}monitor.html#mbeans" target="_blank" rel="noopener noreferrer">
        <i class="si si-lg si-question-circle"></i>
      </a>
    </ui:define>

    <ui:define name="content">
      <div class="ui-fluid">
        <div class="ui-g">
          <div class="ui-g-12 ui-md-12 ui-lg-6 dashboard-card">
            <p:panel style="min-height: 350px;">
              <f:facet name="header">
                <i class="si si-coffee-cup table-icon panel-title-icon"></i>
                <h:outputText value="MBeans" />
              </f:facet>
              <p:tree value="#{mBeansBean.root}" var="node" selectionMode="single" 
                style="border: none; max-height: 350px; overflow: auto; padding: 0;" id="mBeans">
                <p:ajax event="select" update="attributes" listener="#{mBeansBean.onSelectNode}" />
                <p:treeNode type="folder" icon="si si-folder-empty">
                  <h:outputText value="#{node.displayName}" />
                </p:treeNode>
                <p:treeNode type="bean" icon="si si-analytics-bars">
                  <h:outputText value="#{node.displayName}" />
                </p:treeNode>
              </p:tree>
            </p:panel>
          </div>
          <div class="ui-g-12 ui-md-12 ui-lg-6 dashboard-card">
            <p:panel style="min-height: 350px;">
              <f:facet name="header">
                <i class="si si-cog table-icon panel-title-icon"></i>
                <h:outputText value="Attributes" />
              </f:facet>
              <p:dataTable id="attributes" var="mAttr" value="#{mBeansBean.attributes}" rowIndexVar="rowIndex"
                style="max-height: 350px; overflow: auto" emptyMessage="Select a bean to see its attributes">
                <p:column headerText="Name">
                  <h:outputText id="name" value="#{mAttr.name}" />
                  <p:tooltip for="attributes:#{rowIndex}:name" value="#{mAttr.tooltip}" />
                </p:column>

                <p:column headerText="Value">
                  <h:outputText escape="false" value="#{mAttr.value}" />
                </p:column>
                <p:column style="width: 55px">
                  <p:commandButton id="addTrace" rendered="#{mAttr.isTraceable}" update="chart" immediate="true"
                    actionListener="#{mBeansBean.addTrace(mAttr)}" icon="si si-analytics-graph" />
                </p:column>
              </p:dataTable>
            </p:panel>
          </div>
          <div class="ui-g-12 ui-md-12 ui-lg-12 dashboard-card">
            <p:panel id="chart" style="min-height: 350px;">
              <f:facet name="header">
                <i class="si si-analytics-bars table-icon panel-title-icon"></i>
                <h:outputText value="Chart" />
              </f:facet>
              <p:chart id="diagram" type="line" model="#{mBeansBean.tracesMonitor.model}" responsive="true" style="height:300px;" />
              <p:poll update="chart" interval="1" autoStart="#{mBeansBean.tracesMonitor.running}" />

              <p:dataTable id="traces" var="trace" value="#{mBeansBean.traces}" rowIndexVar="rowIndex"
                style="max-height: 200px; overflow: auto">
                <p:column headerText="Attribute">
                  <h:outputText id="attribute" value="#{trace.attributeName}" />
                </p:column>
                <p:column headerText="Object">
                  <h:outputText value="#{trace.objectName}" />
                </p:column>
                <p:column headerText="Description">
                  <h:outputText value="#{trace.description}" />
                </p:column>

                <p:column headerText="Last Value">
                  <h:outputText id="lastValue" value="#{trace.lastValue}" />
                </p:column>
                <p:column style="width: 55px">
                  <p:commandButton id="removeTrace" update="chart" immediate="true" actionListener="#{mBeansBean.removeTrace(trace)}" 
                    icon="si si-remove" styleClass="red-btn" />
                </p:column>
              </p:dataTable>
            </p:panel>
          </div>
        </div>
      </div>
    </ui:define>
  </ui:composition>
</h:body>
</html>