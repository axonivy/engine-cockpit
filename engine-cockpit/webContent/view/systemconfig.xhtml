<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:cc="http://java.sun.com/jsf/composite/composite">
<h:body>
  <f:metadata>
    <f:viewParam name="filter" value="#{systemConfigBean.configView.filter}" />
  </f:metadata>

  <ui:composition template="../includes/template/template.xhtml">

    <ui:define name="breadcrumb">
      <li><a href="systemconfig.xhtml">System Configuration</a></li>
    </ui:define>
    
    <ui:define name="breadcrumb-right">
      <a href="#" onclick="window.open('#{advisorBean.cockpitEngineGuideUrl}system.html#system-configuration'); return false;">
        <i class="material-icons">help</i>
      </a>
    </ui:define>

    <ui:define name="content">
      <div class="ui-fluid">
        <div class="ui-g">
          <div class="ui-g-12">
            <div class="card card-w-title">
              <div class="ui-g">
                <div class="ui-g-12 ui-md-8">
                  <h1>
                    <i class="material-icons card-title-icon">settings</i>
                    <span>System Configuration</span>
                  </h1>
                </div>
                <div class="ui-g-12 ui-md-4" style="margin: auto;">
                  <div class="single-card-top-right-btn">
                    <p:commandButton id="newConfigBtn" value="New" icon="ui-icon-add" actionListener="#{systemConfigBean.configView.setActiveConfig(null)}"
                      update="config:newConfigurationModal" oncomplete="PF('newConfigurationModal').show();" />
                  </div>
                  <div style="float: right; margin-right: 5px;">
                    <h:form id="configMoreForm">
                      <p:commandButton title="More" id="configMoreButton"
                        type="button" icon="ui-icon-menu" styleClass="secondary-btn" style="float: right;" />
                      <p:menu overlay="true" trigger="configMoreButton" my="right top" at="right bottom" id="configMoreMenu" style="min-width:180px;">
                        <p:menuitem value="#{systemConfigBean.configView.showDefaults ? 'Hide' : 'Show'} default values" 
                          icon="ui-icon-visibility#{systemConfigBean.configView.showDefaults ? '-off' : ''}"
                          actionListener="#{systemConfigBean.configView.switchDefaults}" update="@form, config" 
                          id="showDefaultsBtn" oncomplete="PF('configTable').filter()">
                        </p:menuitem>
                        <p:menuitem value="Show config log" icon="ui-icon-format-align-left" onclick="window.location.href='logs.xhtml?log=config.log'"
                          id="showConfigLogBtn" />
                      </p:menu>
                    </h:form>
                  </div>
                </div>
              </div>
              <cc:Configuration bean="#{systemConfigBean.configView}" id="config"/>
            </div>
            
            <script>
              $(document).ready(function() {
                try {
                  var url = new URL(window.location.href)
                  if (url.searchParams.get("filter") != null) {
                    console.log("filter" + url.searchParams.get("filter"));
                    PF('configTable').filter();
                  }
                }
                catch(err) {
                  console.log("Failed to init startup filter: " + err);
                }
              });
            </script>
          </div>
        </div>
      </div>
    </ui:define>
  </ui:composition>
</h:body>
</html>