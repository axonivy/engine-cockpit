<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:cc="http://java.sun.com/jsf/composite/composite">

  <p:remoteCommand name="updateLic" update="fileUploadForm:licenceOverview, licWarnMessage, stepForm:wizardSteps" />

  <h:panelGroup id="licWarnMessage">
    <p:staticMessage rendered="#{!licenceBean.stepOk}" severity="warn" detail="#{licenceBean.stepWarningMessage}"/>
  </h:panelGroup>

  <h:form enctype="multipart/form-data" id="fileUploadForm">
    <div class="file-upload">
      <input type="file" id="fileInput" class="deploy-file" required="required" accept=".lic"/>
      <p:panelGrid columns="2" columnClasses="ui-grid-col-3, ui-grid-col-9" layout="grid" 
        styleClass="ui-panelgrid-blank">
        <p:commandButton id="chooseFileBtn" type="button" icon="ui-icon-add" value="Choose licence" 
          onclick="$('#fileInput').trigger('click')" />
        <h:panelGroup layout="block">
          <span id="uploadStatus" class="file-upload-error" />
          <span id="uploadLog" />
        </h:panelGroup>
      </p:panelGrid>
      <div id="drop_zone" class="ui-g-12">
        <span id="selectedFileOutput" class="file-upload-file">Choose or drop a licence file.</span>
      </div>
    </div>
    
    <h:panelGroup id="licenceOverview">
      <p:dataTable id="licenceInfoTable" var="property"
        rendered="#{!licenceBean.demo}"
        value="#{licenceBean.licenceProperties.entrySet().toArray()}"
        style="width: 100%; overflow-y: auto; max-height: 300px;">
        <p:column headerText="Name">
          <h:outputText value="#{property.key}" styleClass="licence-key" />
        </p:column>
        <p:column headerText="Value">
        <h:outputText
          value="#{property.value eq '0' or '' ? 'Unlimited' : property.value}" />
        </p:column>
      </p:dataTable>
    </h:panelGroup>
  </h:form>
  
  <script>
    var accepts = [".lic"];
    var directUpload = true;
    var uploadUrl = "/#{advisorBean.apiBaseUrl}/#{advisorBean.app}/licence";
    var uploadErrorField = "#uploadStatus";
    
    function uploadDone() {
      updateLic();
    }
    
    initFileUpload();
  </script>
</html>