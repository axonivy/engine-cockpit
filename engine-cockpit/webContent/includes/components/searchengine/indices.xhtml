<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions">
  
<f:facet name="header">
  <i class="si si-common-file-text table-icon panel-title-icon"></i>
  <h:outputText value="Indices" />
</f:facet>
<h:form id="searchEngineIndexForm" style="overflow-y: auto;">
  <p:growl id="searchEngineIndexMessages" for="searchEngineIndexMessages">
    <p:autoUpdate/>
  </p:growl>
  <p:dataTable paginator="true" rows="20" rowsPerPageTemplate="10,20,50" paginatorPosition="bottom" paginatorAlwaysVisible="false"
    paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
    var="index" value="#{searchEngineBean.indices}" filteredValue="#{searchEngineBean.filteredIndicies}"
    lazy="false" id="indiciesTable" widgetVar="indiciesTable" style="min-width: 700px;">
    <f:facet name="header">
      <p:outputPanel>
        <p:outputLabel styleClass="table-search-icon">
          <i class="si si-search"></i>
        </p:outputLabel>
        <p:inputText styleClass="table-search-input-withicon" id="globalFilter"
          onkeyup="PF('indiciesTable').filter()" placeholder="Search" value="#{searchEngineBean.filter}"/>
      </p:outputPanel>
    </f:facet>
    <p:column headerText="Name" sortBy="#{index.name}" filterBy="#{index.name}" styleClass="index-name-column">
      <h:outputText value="#{index.name}" styleClass="index-name" style="overflow: auto">
        <i class="si si-common-file-text table-icon"></i>
      </h:outputText>
    </p:column>
    <p:column headerText="Index" sortBy="#{index.countIndexed}" style="text-align: center; width: 85px;">
      <h:outputText value="#{index.countIndexed}" />
    </p:column>
    <p:column headerText="Store" sortBy="#{index.countStored}" style="text-align: center; width: 85px;">
      <h:outputText value="#{index.countStored}" />
    </p:column>
    <p:column headerText="Health" style="text-align: center; width: 65px; font-weight: bold;">
      <i class="si si-#{index.status.icon} table-icon icon-bold search-machine-health-#{index.status.state}" 
        title="#{index.status.hint}"></i>
    </p:column>
    <p:column headerText="Size" sortBy="#{index.size}" style="text-align: center; width: 75px;">
      <h:outputText value="#{index.size}" />
    </p:column>
    <p:column style="text-align: center; width: 97px;">
      <p:commandButton title="Reindex" icon="si si-button-refresh-arrows #{searchEngineBean.isReindexing(index) ? 'si-is-spinning' : ''} spin-icon"
        style="margin-right: 10px;" styleClass="secondary-btn" id="reindexBtn" oncomplete="PF('reindexSearchEngineModel').show();"
        actionListener="#{searchEngineBean.setActiveIndex(index)}" update="reindexSearchEngineModel" />
      <p:commandButton id="queryToolBtn" title="Run Search Engine Query" icon="si si-monitor-heart-beat-search"
        actionListener="#{searchEngineBean.setActiveIndex(index)}" update="searchEngineQueryToolModal"
        styleClass="secondary-btn" oncomplete="PF('searchEngineQueryToolModal').show()" />
    </p:column>
  </p:dataTable>
  <p:poll widgetVar="reindexPoller" autoStart="#{searchEngineBean.isReindexing()}" interval="2" update="@form" />
</h:form>

<p:dialog style="min-width: 300px;" header="Reindex #{searchEngineBean.activeIndex.name}" id="reindexSearchEngineModel"
  widgetVar="reindexSearchEngineModel" modal="true" responsive="true" closeOnEscape="true">
  
  <p:staticMessage severity="info" summary="This step triggers the reindexation of the search engine and can take a while!" />
  
  <f:facet name="footer">
    <p:commandLink id="cancelChangeSecuritySystem" onclick="PF('reindexSearchEngineModel').hide();" value="Cancel" type="button"
      styleClass="scondary-btn modal-input-button" />
    <p:commandButton id="reindexSearchEngineBtn" update="searchEngineIndexForm" onclick="PF('reindexPoller').start(); PF('reindexSearchEngineModel').hide();"
      actionListener="#{searchEngineBean.reindex}" value="Reindex" icon="si si-button-refresh-arrows"
      styleClass="modal-input-button" />
  </f:facet>
</p:dialog>
</html>
