<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions">

<f:facet name="header">
  <i class="material-icons table-icon panel-title-icon">security</i>
  <h:outputText value="Security System" />
</f:facet>
<h:form id="appDetailSecurityForm">
  <p:commandButton id="synchronizeSecurity"
    rendered="#{applicationDetailBean.securitySystem.securitySystemProvider ne 'ivy Security System'}"
    title="Synchronize" type="button" icon="fa #{securityBean.syncRunningForSelectedApp ? 'fa-spin' : ''} fa-refresh"
    styleClass="primary-btn card-button spin-icon" onclick="PF('logPoller').start()">
    <p:ajax listener="#{securityBean.triggerSyncForSelectedApp}" update="@this" />
  </p:commandButton>
  <p:poll widgetVar="logPoller" autoStart="#{securityBean.syncRunningForSelectedApp}" interval="5" update="@form" />
  <p:commandButton id="changeSecuritySystem" icon="ui-icon-settings" styleClass="secondary-btn card-button"
    onclick="PF('changeSecuritySystemModel').show()" type="button" />
  <p:commandButton id="showAdSyncLogBtn" icon="ui-icon-format-align-left" styleClass="secondary-btn card-button"
    onclick="window.location.href='logs.xhtml?log=usersynch.log'" type="button" 
    rendered="#{!securityBean.ivySecurityForSelectedApp}" />

  <p:panelGrid columns="2" columnClasses="ui-grid-col-4, ui-grid-col-8" layout="grid" styleClass="ui-panelgrid-blank grey-label-panel">
    <label>Name</label>
      <h:outputLink value="#{applicationDetailBean.securitySystem.link}">
        <h:outputText value="#{applicationDetailBean.securitySystem.securitySystemName}" rendered="#{not empty applicationDetailBean.securitySystem.link}">
          <i class="material-icons link-icon">security</i>
        </h:outputText>
      </h:outputLink>
    <label>Provider</label>
    <h:outputText value="#{applicationDetailBean.securitySystem.securitySystemProvider}" />
    <label>Users</label>
    <h:outputLink value="users.xhtml">
      <h:outputText value="#{applicationDetailBean.securitySystem.usersCount}">
        <i class="material-icons link-icon">person</i>
      </h:outputText>
    </h:outputLink>
    <label>Roles</label>
    <h:outputLink value="roles.xhtml">
	    <h:outputText value="#{applicationDetailBean.securitySystem.rolesCount}">
        <i class="material-icons link-icon">people</i>
      </h:outputText>
    </h:outputLink>
  </p:panelGrid>
</h:form>
<ui:include src="../../dialogs/changesecuritysystem.xhtml" />
</html>