<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions">

<f:facet name="header">
  <i class="material-icons table-icon panel-title-icon">settings</i>
  <h:outputText value="Properties" />
</f:facet>
<h:form id="propertiesForm">
  <p:growl for="propertiesMessage" id="propertiesMessage" showDetail="true" />
  <p:commandButton id="newPropertyBtn" oncomplete="PF('propertyModal').show();" process="@this"
    actionListener="#{memberProperty.setProperty(null)}" update="propertyModalForm:propertyModal"
    title="Add" icon="ui-icon-add" styleClass="secondary-btn card-button"/>
  
  <p:dataTable paginator="true" rows="10" rowsPerPageTemplate="10,20,50" paginatorPosition="bottom" paginatorAlwaysVisible="false"
    paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
    var="property" value="#{memberProperty.properties}" widgetVar="propertiesTable" id="propertiesTable"
    filteredValue="#{memberProperty.filteredPropteries}" lazy="false" styleClass="propertiesTable" style="padding-top: 10px;">
    <f:facet name="header">
      <p:outputPanel>
        <p:outputLabel styleClass="table-search-icon">
          <i class="material-icons">search</i>
        </p:outputLabel>
        <p:inputText styleClass="table-search-input-withicon" id="globalFilter"
          onkeyup="PF('propertiesTable').filter()" placeholder="Search" value="#{memberProperty.filter}"/>
      </p:outputPanel>
    </f:facet>
    <p:column headerText="Name" filterBy="#{property.key}" sortBy="#{property.value}">
      <h:outputText value="#{property.key}" styleClass="property-name">
        <i class="material-icons table-icon">settings</i>
      </h:outputText>
    </p:column>

    <p:column headerText="Value" filterBy="#{property.value}">
      <h:outputText value="#{property.value}" title="#{property.value}" styleClass="table-cell-autocut" />
    </p:column>
    
    <p:column style="width: 70px;">
      <p:outputLabel>
        <p:commandButton id="deletePropertyBtn" type="button" disabled="#{property.backed}"
          icon="ui-icon-delete" title="#{property.backed ? 'From Security System' : 'Delete'}" 
          styleClass="card-button table-control-btn red-btn" style="margin: 0;">
          <p:ajax listener="#{memberProperty.removeProperty(property.key)}" update="@form"/>
        </p:commandButton>
        <p:commandButton id="editPropertyBtn" disabled="#{property.backed}" actionListener="#{memberProperty.setProperty(property)}"
          icon="ui-icon-pencil" title="#{property.backed ? 'From Security System' : 'Edit'}" update="propertyModalForm:propertyModal"
          styleClass="card-button table-control-btn secondary-btn" oncomplete="PF('propertyModal').show();" process="@this" />
      </p:outputLabel>
    </p:column>
  </p:dataTable>
</h:form>

<h:form id="propertyModalForm">
  <p:dialog width="auto" header="Property" id="propertyModal" widgetVar="propertyModal"
    modal="true" responsive="true" closeOnEscape="true">
    <p:panelGrid columns="2" layout="grid" columnClasses="ui-grid-col-3, ui-grid-col-9" 
      styleClass="ui-panelgrid-blank form-group modal-input-form grey-label-panel ui-fluid">
      <label>Name</label>
      <h:panelGroup styleClass="md-inputfield" rendered="#{empty memberProperty.property.key}">
        <p:inputText id="propertyNameInput" requiredMessage="Value is required"
          value="#{memberProperty.property.key}" required="true" />
        <p:message for="propertyNameInput" id="propertyNameMessage" />
      </h:panelGroup>
      <h:outputText id="propertyName" rendered="#{not empty memberProperty.property.key}" 
        value="#{memberProperty.property.key}"/>
      
      <label>Value</label>
      <h:panelGroup styleClass="md-inputfield">
        <p:inputTextarea id="propertyValueInput" requiredMessage="Value is required" rows="5" cols="100" autoResize="false"
          value="#{memberProperty.property.value}" required="true" />
        <p:message for="propertyValueInput" id="propertyValueMessage" />
      </h:panelGroup>
    </p:panelGrid>
    <f:facet name="footer">
      <p:commandButton id="cancelProperty" onclick="PF('propertyModal').hide();" value="Cancel" type="button"
        icon="ui-icon-clear" styleClass="secondary-btn modal-input-button" />
      <p:commandButton id="saveProperty" validateClient="true" ajax="false" update=":propertiesForm"
        actionListener="#{memberProperty.saveProperty}" value="Save" icon="ui-icon-save"
        styleClass="modal-input-button" />
    </f:facet>
  </p:dialog>
</h:form>
</html>