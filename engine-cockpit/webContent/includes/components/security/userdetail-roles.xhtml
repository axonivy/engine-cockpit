<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions">

<f:facet name="header">
  <i class="icon ivyicon-multiple-neutral-1 table-icon panel-title-icon"></i>
  <h:outputText value="Roles" />
</f:facet>
<h:form id="rolesOfUserForm">
  <p:growl for="roleMessage">
    <p:autoUpdate/>
  </p:growl>
  <div class="ui-tree-search-header">
    <div class="ui-datatable-header ui-widget-header ui-corner-top">
      <p:outputPanel>
        <span class="table-search-icon">
          <i class="icon ivyicon-search"></i>
        </span>
        <p:inputText styleClass="table-search-input-withicon" placeholder="Search" value="#{userDetailBean.roles.filter}">
          <p:ajax event="keyup" delay="500" update="@form:rolesTree" />
        </p:inputText>
        <p:commandButton id="expandAll" widgetVar="createApplication" icon="icon ivyicon-move-expand-vertical" actionListener="#{userDetailBean.roles.expandAllNodes}"
          update="rolesTree" title="Expand all" styleClass="secondary-btn" />
        <p:commandButton id="collapseAll" widgetVar="createApplication" icon="icon ivyicon-move-shrink-vertical" actionListener="#{userDetailBean.roles.collapseAllNodes}"
          update="rolesTree"  title="Collapse all" styleClass="secondary-btn" />
      </p:outputPanel>
    </div>
  </div>
  <p:treeTable id="rolesTree" value="#{userDetailBean.roles.tree}" var="role" nodeVar="node">
    <p:ajax event="expand" listener="#{userDetailBean.roles.nodeExpand}"/>
    <p:ajax event="collapse" listener="#{userDetailBean.roles.nodeCollapse}"/>
    <p:column headerText="All Roles" sortBy="#{role.name}">
      <p:treeNode type="role" rendered="#{node.type == 'role'}">
	      <a href="roledetail.xhtml?roleName=#{role.name}">
	        <h:outputText value="#{role.name}" styleClass="role-name">
	          <i class="icon ivyicon-multiple-neutral-1 table-icon"></i>
	        </h:outputText>
	        <h:outputText value=" (#{role.displayName})" styleClass="addition-row-info" />
	        <h:panelGroup rendered="#{role.managed and !managerBean.ivySecuritySystem}">
	          <i class="icon ivyicon-button-refresh-arrows table-icon" title="Role is managed by the external security system" style="margin-left: 0.5em;"></i>
	        </h:panelGroup>
	      </a>
      </p:treeNode>
      <p:treeNode type="dummy" rendered="#{node.type == 'dummy'}">
        <h:outputText value="#{role.name}"
          title="For performance reasons only the first 100 roles are loaded. Use the search to find a specific role.">
          <i class="icon ivyicon-navigation-menu-horizontal table-icon"></i>
        </h:outputText>
      </p:treeNode>
    </p:column>
    <p:column style="width: 41px;">
      <h:panelGroup rendered="#{node.type == 'role'}">
	      <h:outputText
	        rendered="#{userDetailBean.isUserMemberOfAllRole(role.name) and !userDetailBean.isUserMemberOfRole(role.name)}">
	        <i class="icon ivyicon-check-circle table-icon member-inherit-icon no-margin" title="Inherited" />
	      </h:outputText>
	      <h:outputText
	        rendered="#{userDetailBean.isUserMemberOfAllRole(role.name) and userDetailBean.isUserMemberOfRole(role.name)}">
	        <i class="icon ivyicon-check-circle table-icon no-margin" />
	      </h:outputText>
      </h:panelGroup>
    </p:column>
    <p:column style="width: 95px;">
      <h:panelGroup rendered="#{node.type == 'role'}">
	      <p:commandButton id="addRoleToUserBtn" update="@form" actionListener="#{userDetailBean.addRole(role.name)}"
	        icon="icon ivyicon-add" title="Add" styleClass="card-button table-control-btn primary-btn" style="margin: 0;"
	        disabled="#{role.name == 'Everybody' or userDetailBean.isUserMemberOfRole(role.name) or role.managed and !managerBean.ivySecuritySystem}" />
	      <p:commandButton id="removeRoleFromUserBtn" update="@form"
	        actionListener="#{userDetailBean.removeRole(role.name)}" icon="icon ivyicon-subtract" title="Remove"
	        styleClass="card-button table-control-btn secondary-btn"
	        disabled="#{role.name == 'Everybody' or !userDetailBean.isUserMemberOfRole(role.name) or role.managed and !managerBean.ivySecuritySystem}" />
      </h:panelGroup>
    </p:column>
  </p:treeTable>
</h:form>
</html>