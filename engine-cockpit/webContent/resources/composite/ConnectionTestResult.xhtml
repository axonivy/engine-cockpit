<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui"
  xmlns:jc="http://xmlns.jcp.org/jsf/composite/demo-jsfcomponents">
<cc:interface>
  <cc:attribute name="url" />
  <cc:attribute name="result" />
  <cc:attribute name="reset" />
  <cc:attribute name="testMethod" />
  <cc:attribute name="bean" />
  <cc:attribute name="saveHint" default="false" />
</cc:interface>
<cc:implementation>
  <p:dialog header="Connection Test - Url: #{cc.attrs.url}" id="connectionTestModel" width="70%"
    widgetVar="connectionTestModel" modal="true" responsive="false" closeOnEscape="true" >
    <p:staticMessage rendered="#{cc.attrs.saveHint}" severity="info" summary="Info" detail="Make sure that you saved your changes before you test the connection." />
    <h:form id="connTestForm" styleClass="custom-dialog-form">
      <h:panelGrid id="missingCertView" rendered="#{tlsTesterBean.isHttps(cc.attrs.url)}">
        <p:outputLabel id="subject" value="#{cc.attrs.bean.missingCertsSubject}"></p:outputLabel>
        <i class="si si-question-circle"></i>
        <p:tooltip for="@parent" position="top" value="#{cc.attrs.bean.formatedCert}"></p:tooltip>
        <p:commandButton id="add" value="add" icon="si si-arrow-right" disabled="#{cc.attrs.bean.isDisableAddUntrust()}"
          styleClass="modal-input-button" update="connTestForm"
          actionListener="#{trustStoreBean.addToStore(cc.attrs.bean.missingCert)}" action="#{cc.attrs.bean.setDisableAddUntrust(true)}" ></p:commandButton>
      </h:panelGrid>
      <h:panelGrid id="resultLog" columns="1" style="height:500px" styleClass="ui-fluid">
        <h:panelGroup id="resultConnect">
          <h:outputText value="#{cc.attrs.result.testResult}"
            style="font-weight: bold; color: #{cc.attrs.result.testResultColor}" />
          <pre style="max-height: 200px; overflow: auto; margin: 0;">#{cc.attrs.result.message}</pre>
        </h:panelGroup>
        <h:panelGroup id="resultTLS" styleClass="ui-fluid"
          rendered="#{tlsTesterBean.tlsTestRendered}">
          <jc:TlsTester url="#{cc.attrs.url}" />
        </h:panelGroup>
      </h:panelGrid>
      <div class="custom-dialog-footer">
        <p:commandButton id="closeConTesterDialog" onclick="PF('connectionTestModel').hide(); #{cc.attrs.reset};" 
           value="Close" type="button" update="connTestForm"
           styleClass="modal-input-button ui-button-secondary ui-button-flat"/>
        <p:commandButton id="testTlsConectionBtn" title="TLS Connection Test" rendered="#{tlsTesterBean.isHttps(cc.attrs.url)}"
           icon="si si-arrow-right" value="TLS Test"
           update="resultLog missingCertView" styleClass="modal-input-button"
           actionListener="#{tlsTesterBean.testConnection(cc.attrs.url)}" />
        <p:commandButton id="testConnectionBtn" title="Test Connection" update="connTestForm" value="Test Connection"
           icon="si si-arrow-right" styleClass="modal-input-button" actionListener="#{cc.attrs.testMethod};"
           immediate="true" process="@this" async="true" onclick="buttonAddSpinner(this);" action="#{tlsTesterBean.setTlsTestRendered(false)}"/>
      </div>
    </h:form>
  </p:dialog>
</cc:implementation>

</html>
