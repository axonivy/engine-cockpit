<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui">
<cc:interface>
  <cc:attribute name="updateFields" />
  <cc:attribute name="ldapBrowser" />
  <cc:attribute name="returnListener" />
</cc:interface>
  
<cc:implementation>
  <p:dialog id="ldapBrowserDialog" header="Ldap Browser" widgetVar="ldapBrowserDialog" modal="true" closeOnEscape="true" width="700">
    <h:form id="ldapBrowserForm" styleClass="ldap-browser">
      <p:messages id="ldapBrowserMessage" for="ldapBrowserMessage" showDetail="true">
        <p:autoUpdate />
      </p:messages>
      <p:panelGrid layout="grid" columns="2" styleClass="ui-panelgrid-blank" columnClasses="ui-g-12 ui-md-5, ui-g-12 ui-md-7">
        <p:tree id="tree" widgetVar="tree" value="#{cc.attrs.ldapBrowser.tree}" var="node"
          selectionMode="single" selection="#{cc.attrs.ldapBrowser.selectedNode}" dynamic="true">
          <p:ajax event="expand" listener="#{cc.attrs.ldapBrowser.onNodeExpand}" update="@form:tree"/>
          <p:ajax event="select" update="@form:nodeAttrTable" />
          <p:treeNode icon="ui-icon-#{node.icon}">
            <h:outputText value="#{node}" />
          </p:treeNode>
        </p:tree>
        <p:dataTable id="nodeAttrTable" var="attr" value="#{cc.attrs.ldapBrowser.selectedNodeAttributes}"
          scrollable="true" scrollHeight="355" emptyMessage="Select a node to see its attributes"
          rendered="#{cc.attrs.ldapBrowser.tree != null}">
          <p:column headerText="Name" >
            <h:outputText value="#{attr.name}" styleClass="node-attr-name" />
          </p:column>
          <p:column headerText="Value" style="min-width: #{empty cc.attrs.ldapBrowser.selectedNodeAttributes ? '100px' : '1000px'};">
            <h:outputText value="#{attr.ldapAttribute}" />
          </p:column>
        </p:dataTable>
      </p:panelGrid>
    </h:form>
    <f:facet name="footer">
      <p:commandLink id="cancelLdapBrowser" onclick="PF('ldapBrowserDialog').hide();" value="Cancel" type="button"
        styleClass="secondary-btn modal-input-button" />
      <p:commandButton id="chooseLdapName" actionListener="#{cc.attrs.returnListener}" value="Choose" icon="ui-icon-check"
        styleClass="primary-btn modal-input-button" update="#{cc.attrs.updateFields}" onclick="PF('ldapBrowserDialog').hide();"
        disabled="#{cc.attrs.ldapBrowser.tree == null}" />
    </f:facet>
  </p:dialog>
</cc:implementation>
</html>
