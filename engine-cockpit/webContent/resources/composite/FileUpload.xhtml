<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:cc="http://xmlns.jcp.org/jsf/composite"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui">
<cc:interface>
  <cc:attribute name="title" default="File Upload" />
  <cc:attribute name="apiUrl" />
  <cc:attribute name="acceptFiles" />
</cc:interface>
<cc:implementation>
  <p:dialog style="margin-left: 120px; min-width: 550px; max-width: 700px;" header="#{cc.attrs.title}" id="fileUploadModal" resizable="false"
    widgetVar="fileUploadModal" modal="true" responsive="true" closeOnEscape="true" styleClass="ui-fluid">
    <form enctype="multipart/form-data" id="fileUploadForm">
      <div class="file-upload">
        <input type="file" id="fileInput" class="deploy-file" required="required" accept="#{cc.attrs.acceptFiles}" />
        <p:panelGrid columns="2" columnClasses="ui-grid-col-4, ui-grid-col-8" layout="grid" 
          styleClass="ui-panelgrid-blank">
          <p:commandButton id="chooseFileBtn" type="button" icon="ui-icon-add" value="Choose file" 
            onclick="$('#fileInput').trigger('click')" style="width: 100%;" />
          <div id="drop_zone">
            <span id="selectedFileOutput" class="file-upload-file" />
          </div>
        </p:panelGrid>
        <div id="uploadError" class="file-upload-error" />
        <cc:insertChildren />
      </div>
      <p:commandButton id="uploadBtn" validateClient="true" type="button" value="Upload" icon="ui-icon-cloud-upload"
        styleClass="modal-input-button" onclick="upload();" />
      <p:commandLink id="cancelDeploymentBtn" onclick="PF('fileUploadModal').hide();" value="Cancel" type="button"
        styleClass="modal-input-button" />
    </form>
    <div id="fileUploadResponse" style="display:none;">
      <i id="uploadFileSpinner" class="fa fa-circle-o-notch fa-spin ajax-loader" aria-hidden="true" />
      <div style="font-weight: bold;" id="uploadStatus"></div>
      <pre style="max-height: 500px; overflow: auto;" id="uploadLog"></pre>
      <p:commandButton id="closeDeploymentBtn" onclick="closeFileUpload();" value="Close" type="button"
        icon="ui-icon-clear" styleClass="modal-input-button" />
      <p:commandButton id="backBtn" type="button" value="Back" icon="ui-icon-keyboard-backspace"
        styleClass="secondary-btn modal-input-button" onclick="back();" />
    </div>
    <script>
      var accepts = "#{cc.attrs.acceptFiles}".split(",").map(Function.prototype.call, String.prototype.trim);
      var uploadUrl = "#{advisorBean.apiBaseUrl}/#{cc.attrs.apiUrl}"
    
      function beforeUpload() {
        $('#fileUploadResponse').show();
        $('#fileUploadForm').hide();
        $('#uploadFileSpinner').show();
      }
      
      function uploadedAlways() {
        $('#uploadFileSpinner').hide();
        PF('fileUploadModal').initPosition();
      }
    
      initFileUpload();
      
      function back() {
        $('#fileUploadResponse').hide();
        $('#fileUploadForm').show();
        $('#uploadLog').text("");
        $('#uploadStatus').text("");
        PF('fileUploadModal').initPosition();
      }

      function closeFileUpload() {
        PF('fileUploadModal').hide();
        window.location.href = window.location.href;
      }
    </script>
  </p:dialog>
</cc:implementation>
</html>
