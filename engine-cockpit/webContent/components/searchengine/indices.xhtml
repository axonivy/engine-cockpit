<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions">
  
<f:facet name="header">
  <i class="material-icons table-icon panel-title-icon">insert_drive_file</i>
  <h:outputText value="Indices" />
</f:facet>
<h:form id="searchEngineIndexForm" style="overflow-y: auto;">
  <p:growl id="searchEngineIndexMessages" for="searchEngineIndexMessages">
    <p:autoUpdate/>
  </p:growl>
  <p:dataTable paginator="true" rows="20" rowsPerPageTemplate="10,20,50" paginatorPosition="bottom" paginatorAlwaysVisible="false"
    paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
    var="index" value="#{searchEngineBean.indices}" filteredValue="#{searchEngineBean.filteredIndicies}"
    lazy="false" id="indiciesTable" widgetVar="indiciesTable" style="min-width: 700px;">
    <f:facet name="header">
      <p:outputPanel>
        <p:outputLabel styleClass="table-search-icon">
          <i class="material-icons">search</i>
        </p:outputLabel>
        <p:inputText styleClass="table-search-input-withicon" id="globalFilter"
          onkeyup="PF('indiciesTable').filter()" placeholder="Search" value="#{searchEngineBean.filter}"/>
      </p:outputPanel>
    </f:facet>
    <p:column headerText="Name" sortBy="#{index.name}" filterBy="#{index.name}" styleClass="index-name-column">
      <h:outputText value="#{index.name}" styleClass="index-name" style="overflow: auto">
        <i class="material-icons table-icon">insert_drive_file</i>
      </h:outputText>
    </p:column>
    <p:column headerText="Index" sortBy="#{index.countIndexed}" style="text-align: center; width: 60px;">
      <h:outputText value="#{index.countIndexed}" />
    </p:column>
    <p:column headerText="Store" sortBy="#{index.countStored}" style="text-align: center; width: 60px;">
      <h:outputText value="#{index.countStored}" />
    </p:column>
    <p:column headerText="Health" style="text-align: center; width: 50px; font-weight: bold;">
      <i class="material-icons table-icon search-machine-state search-machine-health-#{index.status.state}" 
        title="#{index.status.state}">#{index.status.icon}</i>
    </p:column>
    <p:column headerText="Size" sortBy="#{index.size}" style="text-align: center; width: 60px;">
      <h:outputText value="#{index.size}" />
    </p:column>
    <p:column style="text-align: center; width: 72px;">
      <p:commandButton title="Reindex" icon="fa fa-refresh #{searchEngineBean.isReindexing(index) ? 'fa-spin' : ''} spin-icon"
        style="margin-right: 10px;" id="reindexBtn" oncomplete="PF('reindexSearchEngineModel').show();"
        actionListener="#{searchEngineBean.setActiveIndex(index)}" update="reindexSearchEngineModel" />
      <p:commandButton id="queryToolBtn" title="Run Search Engine Query" icon="ui-icon-bug-report"
        actionListener="#{searchEngineBean.setActiveIndex(index)}" update="searchEngineQueryToolModal"
        styleClass="amber-btn" oncomplete="PF('searchEngineQueryToolModal').show()" />
    </p:column>
  </p:dataTable>
  <p:poll widgetVar="reindexPoller" autoStart="#{searchEngineBean.isReindexing()}" interval="2" update="@form" />
</h:form>

<p:dialog style="min-width: 300px;" header="Reindex #{searchEngineBean.activeIndex.name}" id="reindexSearchEngineModel"
  widgetVar="reindexSearchEngineModel" modal="true" responsive="true" closeOnEscape="true">
  <h:form id="reindexSearchEngineForm">
    <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group modal-input-form">
      <h:panelGroup layout="block" styleClass="static-message static-info-message">
        <i class="fa fa-info-circle"/>
        <h:outputText value="This step triggers the reindexation of the search engine and can take a while!"/>
      </h:panelGroup>
    </p:panelGrid>
    <p:commandButton id="reindexSearchEngineBtn" update="searchEngineIndexForm" onclick="PF('reindexPoller').start(); PF('reindexSearchEngineModel').hide();"
      actionListener="#{searchEngineBean.reindex}" value="Reindex" icon="ui-icon-refresh"
      styleClass="primary-btn modal-input-button" />
    <p:commandButton id="cancelChangeSecuritySystem" onclick="PF('reindexSearchEngineModel').hide();" value="Cancel" type="button"
      icon="ui-icon-clear" styleClass="secondary-btn modal-input-button" />
  </h:form>
</p:dialog>
</html>