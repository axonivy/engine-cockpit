<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:pm="http://primefaces.org/mobile">

<h:form id="membersOfRoleForm">
  <!-- TODO: bug on serach and add/remove, form not correctly updated -->
  <p:growl for="membersMessage" autoUpdate="true" />
  <div class="ui-g">
    <div class="ui-g-6">
      <div class="ui-datatable-header ui-widget-header ui-corner-top">
        <div class="ui-outputpanel ui-widget">
          <label style="float: left;" class="ui-outputlabel ui-widget table-search-icon"> <i
            class="material-icons">search</i>
          </label>
          <p:inputText style="width: calc(100% - 24px); color: #ffffff;" placeholder="Search"
            value="#{roleBean.filter}">
            <p:ajax event="keyup" delay="300" update="membersOfRoleForm" />
          </p:inputText>
        </div>
      </div>
      <!-- TODO: dont render itself and members -->
      <p:treeTable value="#{roleBean.roles}" var="role">
        <p:column headerText="All Roles" sortBy="#{role.name}" rendered="#{!roleDetailBean.isRoleMemberOfRole(role.name)}">
          <h:outputText value="#{role.name}">
            <i class="material-icons table-icon">group</i>
            <p:commandButton update="membersOfRoleForm" actionListener="#{roleDetailBean.addMember(role.name)}" icon="ui-icon-add"
              title="Add" styleClass="card-button table-control-btn primary-btn"/>
          </h:outputText>
        </p:column>
      </p:treeTable>
    </div>
    <div class="ui-g-6">
      <p:dataTable value="#{roleDetailBean.membersOfRole}" widgetVar="membersOfRoleTable" var="member"
        filteredValue="#{roleDetailBean.filteredMembers}" lazy="false">
        <f:facet name="header">
          <p:outputPanel>
            <p:outputLabel styleClass="table-search-icon">
              <i class="material-icons">search</i>
            </p:outputLabel>
            <p:inputText styleClass="table-search-input-withicon" id="globalFilter"
              onkeyup="PF('membersOfRoleTable').filter()" placeholder="Search" />
          </p:outputPanel>
        </f:facet>
        <p:column headerText="Members Of Role" sortBy="#{member.name}" filterBy="#{member.name}">
          <h:outputText value="#{member.name}">
            <i class="material-icons table-icon">people</i>
            <p:commandButton update="membersOfRoleForm" actionListener="#{roleDetailBean.removeMember(member.name)}"
              icon="ui-icon-remove" title="Remove" styleClass="card-button table-control-btn secondary-btn"/>
          </h:outputText>
        </p:column>
      </p:dataTable>
    </div>
  </div>
</h:form>
</html>