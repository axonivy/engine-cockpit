<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:pm="http://primefaces.org/mobile">

<f:facet name="header">
  <i class="material-icons table-icon panel-title-icon">security</i>
  <h:outputLabel value="Security System" />
</f:facet>
<h:form id="appDetailSecurityForm">
  <p:commandButton id="synchronizeSecurity"
    rendered="#{applicationDetailBean.securitySystem.securitySystemProvider ne 'ivy Security System'}"
    title="Synchronize" type="button" icon="fa #{securityBean.syncRunningForSelectedApp ? 'fa-spin' : ''} fa-refresh"
    styleClass="primary-btn card-button spin-icon" onclick="PF('logPoller').start()">
    <p:ajax listener="#{securityBean.triggerSyncForSelectedApp}" update="@this" />
  </p:commandButton>
  <p:poll widgetVar="logPoller" autoStart="#{securityBean.syncRunningForSelectedApp}" interval="1" update="@form" />
  <p:commandButton id="showAdSyncLogBtn" icon="fa fa-info" styleClass="secondary-btn card-button"
    rendered="#{securityBean.anySyncRunningOrNewLog}" type="button" />
  <p:overlayPanel rendered="#{securityBean.anySyncRunningOrNewLog}" id="adSyncLog" for="showAdSyncLogBtn"
    hideEffect="fade">
    <p:inputTextarea style="min-width: 400px; max-height: 600px; overflow-y: auto; background-image: none;" readonly="true" id="logViewer"
      value="#{securityBean.logs}" rows="1" />
  </p:overlayPanel>
  <p:panelGrid columns="2" columnClasses="ui-grid-col-5, ui-grid-col-7" layout="grid" styleClass="ui-panelgrid-blank">
    <p:outputLabel value="Name" />
    <p:selectOneMenu id="securitySystemSelect"
      value="#{applicationDetailBean.securitySystem.securitySystemName}"
      onchange="return confirm('This action will synchronize all users and roles, do you want to proceed?')"
      valueChangeListener="#{applicationDetailBean.setSecuritySystem}">
      <f:selectItems value="#{securityBean.availableSecuritySystems}" />
      <p:ajax update="@form" />
    </p:selectOneMenu>
    <p:outputLabel value="Provider" />
    <p:outputLabel value="#{applicationDetailBean.securitySystem.securitySystemProvider}" />
    <p:outputLabel value="Users" />
    <p:outputLabel value="#{applicationDetailBean.securitySystem.usersCount}">
      <a href="users.xhtml" style="margin-left: 10px;"><i class="fa fa-external-link" /></a>
    </p:outputLabel>
    <p:outputLabel value="Roles" />
    <p:outputLabel value="#{applicationDetailBean.securitySystem.rolesCount}">
      <a href="roles.xhtml" style="margin-left: 10px;"><i class="fa fa-external-link" /></a>
    </p:outputLabel>
  </p:panelGrid>
</h:form>
</html>